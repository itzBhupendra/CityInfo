using System;
using System.Collections.Generic;

public class Record
{
    public int Id { get; set; }
    public string Name { get; set; }
    public string Category { get; set; }
}

public class DataAccess
{
    public List<List<Record>> SplitRecordToHierarchies(List<Record> records, Func<Record, string> splitCriteria)
    {
        var hierarchies = new Dictionary<string, List<Record>>();

        foreach (var record in records)
        {
            var criteria = splitCriteria(record);
            if (!hierarchies.ContainsKey(criteria))
            {
                hierarchies[criteria] = new List<Record>();
            }
            hierarchies[criteria].Add(record);
        }

        var result = new List<List<Record>>();
        foreach (var hierarchy in hierarchies.Values)
        {
            result.Add(hierarchy);
        }

        return result;
    }
}
