using System;
using System.Collections.Generic;
using System.Data;
using System.Data.SqlClient; // or your preferred database provider
using Dapper;

public class DataAccess
{
    private readonly IDbConnection _connection;

    public DataAccess(IDbConnection connection)
    {
        _connection = connection ?? throw new ArgumentNullException(nameof(connection));
    }

    public Dictionary<string, int> QueryMultiple(string sql)
    {
        using (var multi = _connection.QueryMultiple(sql))
        {
            var results = new Dictionary<string, int>();

            for (int i = 0; i < int.MaxValue; i++)
            {
                // Try reading each result set until there are no more
                var hasNextResult = multi.NextResult();
                if (!hasNextResult) break;

                var resultName = $"Result{i + 1}";
                results[resultName] = multi.Read<dynamic>().Count;
            }

            return results;
        }
    }
}
